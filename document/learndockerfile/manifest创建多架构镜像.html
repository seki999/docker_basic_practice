æ˜¯çš„ï¼Œå¤šæ¶æ„é•œåƒï¼ˆMulti-Architecture Imageï¼‰ æ˜¯ä¸€ç§é€‚ç”¨äºå¤šä¸ªå¹³å°ï¼ˆCPU æ¶æ„ï¼‰çš„ Docker é•œåƒã€‚<br>
 1. ä¸ºä»€ä¹ˆéœ€è¦å¤šæ¶æ„é•œåƒï¼Ÿ<br>
ä¸åŒçš„è®¡ç®—å¹³å°ï¼ˆCPU æ¶æ„ï¼‰ä½¿ç”¨ä¸åŒçš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯¼è‡´ç›¸åŒçš„ç¨‹åºåœ¨ä¸åŒå¹³å°ä¸Šéœ€è¦ä¸åŒçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š<br>
- x86_64ï¼ˆAMD64ï¼‰ï¼šå¸¸è§äº PC å’ŒæœåŠ¡å™¨ï¼ˆIntelã€AMD å¤„ç†å™¨ï¼‰ã€‚<br>
- ARM64ï¼ˆAArch64ï¼‰ï¼šå¸¸è§äº Raspberry Piã€Apple M1/M2ã€AWS Gravitonã€‚<br>
- ARMv7ï¼ˆarm32ï¼‰ï¼šè€æ—§çš„ ARM è®¾å¤‡ã€‚<br>
- PPC64LEï¼ˆPowerPCï¼‰ï¼šIBM æœåŠ¡å™¨ã€‚<br>
- s390xï¼šIBM Z ç³»åˆ—ä¸»æœºã€‚<br>
å¦‚æœæ²¡æœ‰ å¤šæ¶æ„é•œåƒï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸ºæ¯ä¸ªæ¶æ„ç»´æŠ¤ä¸åŒçš„é•œåƒï¼Œä¾‹å¦‚ï¼š<br>
```bash<br>
docker pull myrepo/myapp-amd64<br>
docker pull myrepo/myapp-arm64<br>
docker pull myrepo/myapp-ppc64le<br>
```<br>
è¿™ä¼šå¢åŠ è¿ç»´ç®¡ç†çš„å¤æ‚æ€§ã€‚<br>
 2. å¤šæ¶æ„é•œåƒçš„æ¦‚å¿µ<br>
å¤šæ¶æ„é•œåƒ = ä¸€ä¸ªé•œåƒåç§°ï¼Œå¤šä¸ªé€‚é…ä¸åŒæ¶æ„çš„é•œåƒç‰ˆæœ¬<br>
å½“æˆ‘ä»¬ä½¿ç”¨ `docker pull myrepo/myapp` æ—¶ï¼ŒDocker ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰å¹³å°ï¼Œå¹¶ä¸‹è½½é€‚åˆè¯¥å¹³å°çš„é•œåƒï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨åŒºåˆ†ä¸åŒæ¶æ„çš„ç‰ˆæœ¬ã€‚<br>
ç¤ºä¾‹ï¼š<br>
```bash<br>
docker pull ubuntu:latest<br>
```<br>
è¿™ä¸ªå‘½ä»¤åœ¨ï¼š<br>
- x86_64 æœºå™¨ä¸Šä¼šæ‹‰å– x86_64 ç‰ˆæœ¬çš„ Ubuntu é•œåƒã€‚<br>
- ARM64 æœºå™¨ä¸Šä¼šæ‹‰å– ARM64 ç‰ˆæœ¬çš„ Ubuntu é•œåƒã€‚<br>
è¿™ç§æœºåˆ¶ä¾èµ–äº Docker Manifestï¼ˆé•œåƒæ¸…å•ï¼‰ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªæ¶æ„çš„é•œåƒå…³è”ä¸ºåŒä¸€ä¸ªæ ‡ç­¾ã€‚<br>
 3. å¦‚ä½•åˆ›å»ºå¤šæ¶æ„é•œåƒ<br>
 æ–¹æ³• 1ï¼šä½¿ç”¨ `docker manifest`<br>
å…ˆæ„å»ºä¸åŒæ¶æ„çš„é•œåƒï¼š<br>
```bash<br>
docker build --platform linux/amd64 -t myrepo/myapp:amd64 .<br>
docker push myrepo/myapp:amd64<br>
docker build --platform linux/arm64 -t myrepo/myapp:arm64 .<br>
docker push myrepo/myapp:arm64<br>
```<br>
ç„¶ååˆ›å»ºä¸€ä¸ª å¤šæ¶æ„ manifestï¼Œå°†å®ƒä»¬åˆå¹¶ï¼š<br>
```bash<br>
docker manifest create myrepo/myapp:latest \<br>
  myrepo/myapp:amd64 \<br>
  myrepo/myapp:arm64<br>
docker manifest push myrepo/myapp:latest<br>
```<br>
è¿™æ ·ï¼Œ`myrepo/myapp:latest` å°±æˆä¸ºäº†ä¸€ä¸ªå¤šæ¶æ„é•œåƒï¼ŒDocker ä¼šæ ¹æ®ç”¨æˆ·çš„ CPU æ¶æ„è‡ªåŠ¨æ‹‰å–å¯¹åº”çš„é•œåƒã€‚<br>
 æ–¹æ³• 2ï¼šä½¿ç”¨ `docker buildx`<br>
`buildx` æ˜¯ Docker çš„æ–°å·¥å…·ï¼Œæ”¯æŒ ä¸€æ¡å‘½ä»¤åŒæ—¶æ„å»ºå¤šæ¶æ„é•œåƒï¼š<br>
```bash<br>
docker buildx build --platform linux/amd64,linux/arm64,linux/ppc64le \<br>
  -t myrepo/myapp:latest --push .<br>
```<br>
è¿™æ¯” `docker manifest` æ–¹å¼æ›´ç®€å•ï¼Œå®ƒä¼šè‡ªåŠ¨åœ¨ä¸åŒæ¶æ„çš„ QEMU æ¨¡æ‹Ÿå™¨ç¯å¢ƒä¸­æ„å»ºé•œåƒã€‚<br>
 4. å¦‚ä½•æŸ¥çœ‹é•œåƒæ”¯æŒå“ªäº›æ¶æ„<br>
ä½ å¯ä»¥ä½¿ç”¨ `docker manifest inspect` å‘½ä»¤æŸ¥çœ‹æŸä¸ªé•œåƒçš„å¤šæ¶æ„æ”¯æŒæƒ…å†µï¼š<br>
```bash<br>
docker manifest inspect ubuntu:latest<br>
```<br>
è¾“å‡ºç¤ºä¾‹ï¼š<br>
```json<br>
"manifests": [<br>
  {<br>
    "platform": {<br>
      "architecture": "amd64",<br>
      "os": "linux"<br>
    }<br>
  },<br>
  {<br>
    "platform": {<br>
      "architecture": "arm64",<br>
      "os": "linux"<br>
    }<br>
  },<br>
  {<br>
    "platform": {<br>
      "architecture": "s390x",<br>
      "os": "linux"<br>
    }<br>
  }<br>
]<br>
```<br>
è¯´æ˜ `ubuntu:latest` æ”¯æŒå¤šä¸ªæ¶æ„ï¼ŒåŒ…æ‹¬ `x86_64`ã€`ARM64`ã€`s390x` ç­‰ã€‚<br>
 5. æ€»ç»“<br>
âœ” ä¸åŒå¹³å°éœ€è¦ä¸åŒçš„é•œåƒï¼Œå› ä¸º CPU æ¶æ„ä¸åŒã€‚  <br>
âœ” å¤šæ¶æ„é•œåƒ è®© Docker è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„é•œåƒï¼Œé¿å…æ‰‹åŠ¨åŒºåˆ† `-amd64`ã€`-arm64` ç­‰ç‰ˆæœ¬ã€‚  <br>
âœ” `docker manifest` å’Œ `docker buildx` éƒ½å¯ä»¥ç”¨æ¥åˆ›å»ºå¤šæ¶æ„é•œåƒï¼Œæ¨èä½¿ç”¨ `buildx`ã€‚  <br>
âœ” å¤šæ¶æ„é•œåƒçš„åº”ç”¨åœºæ™¯ï¼š<br>
   - é€‚ç”¨äº Raspberry Piï¼ˆARM64ï¼‰ï¼Œæ— éœ€ç‰¹æ„æ‰¾ ARM ç‰ˆæœ¬çš„é•œåƒã€‚<br>
   - äº‘è®¡ç®—ç¯å¢ƒï¼ˆAWS Gravitonã€Apple M1/M2ï¼‰å¯ä»¥ç›´æ¥ä½¿ç”¨ç›¸åŒçš„é•œåƒéƒ¨ç½²ã€‚<br>
   - ç®€åŒ– CI/CDï¼Œåªç»´æŠ¤ä¸€ä¸ªé•œåƒåç§°ï¼Œä¸éœ€è¦å•ç‹¬ç®¡ç† `-amd64`ã€`-arm64` ç‰ˆæœ¬ã€‚<br>
ğŸš€ å¤šæ¶æ„é•œåƒ = ä¸€ä¸ªé•œåƒåç§°ï¼Œé€‚é…å¤šä¸ª CPU æ¶æ„ï¼Œè®© Docker è‡ªåŠ¨é€‰æ‹©æ­£ç¡®ç‰ˆæœ¬ï¼<br>
æ˜¯çš„ï¼Œå¤šæ¶æ„é•œåƒéœ€è¦å¼€å‘è€…ï¼ˆæˆ– DevOpsï¼‰å…ˆæ„å»ºå¥½ï¼Œå¹¶æ¨é€åˆ°é•œåƒä»“åº“ï¼ˆå¦‚ Docker Hubã€Harborã€AWS ECR ç­‰ï¼‰åï¼Œå›¢é˜Ÿçš„å…¶ä»–æˆå‘˜æ‰èƒ½ä½¿ç”¨ã€‚  <br>
 1. å¤šæ¶æ„é•œåƒçš„æ„å»ºæµç¨‹<br>
é€šå¸¸ï¼Œå¤šæ¶æ„é•œåƒçš„æ„å»ºè€…ï¼ˆå¼€å‘è€…æˆ– DevOps å›¢é˜Ÿï¼‰éœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š<br>
1. ä¸ºä¸åŒæ¶æ„æ„å»ºé•œåƒ<br>
   - ä½¿ç”¨ `docker build --platform` æˆ– `docker buildx build` ç”Ÿæˆé€‚ç”¨äºä¸åŒ CPU æ¶æ„çš„é•œåƒã€‚<br>
2. æ¨é€å„ä¸ªæ¶æ„çš„é•œåƒ<br>
   - å…ˆå°†ä¸åŒæ¶æ„çš„é•œåƒæ¨é€åˆ°é•œåƒä»“åº“ã€‚<br>
3. åˆ›å»º `manifest` å¹¶æ¨é€<br>
   - ä½¿ç”¨ `docker manifest create` æˆ– `buildx` ç”Ÿæˆä¸€ä¸ªå¤šæ¶æ„é•œåƒï¼Œè®© Docker å¯ä»¥è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æ¶æ„ã€‚<br>
 2. å›¢é˜Ÿæˆå‘˜å¦‚ä½•ä½¿ç”¨å¤šæ¶æ„é•œåƒï¼Ÿ<br>
ä¸€æ—¦ å¤šæ¶æ„é•œåƒ è¢«æ„å»ºå¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆå¦‚ Docker Hubï¼‰ï¼Œå›¢é˜Ÿçš„å…¶ä»–æˆå‘˜å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š<br>
```bash<br>
docker pull myrepo/myapp:latest<br>
```<br>
Docker ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰è®¾å¤‡çš„ CPU æ¶æ„ï¼Œå¹¶æ‹‰å–æ­£ç¡®çš„ç‰ˆæœ¬ï¼Œæ— é¡»æ‰‹åŠ¨æŒ‡å®šä¸åŒçš„ `-amd64` æˆ– `-arm64` ç‰ˆæœ¬ã€‚<br>
 ç¤ºä¾‹<br>
å¦‚æœ `myrepo/myapp:latest` æ˜¯ä¸€ä¸ªå¤šæ¶æ„é•œåƒï¼š<br>
- åœ¨ x86_64 æœåŠ¡å™¨ä¸Šï¼š<br>
  ```bash<br>
  docker run myrepo/myapp:latest<br>
  ```<br>
  - è‡ªåŠ¨æ‹‰å– `myrepo/myapp:latest-amd64`<br>
- åœ¨ ARM64ï¼ˆå¦‚ Apple M1/M2ã€æ ‘è“æ´¾ï¼‰ä¸Šï¼š<br>
  ```bash<br>
  docker run myrepo/myapp:latest<br>
  ```<br>
  - è‡ªåŠ¨æ‹‰å– `myrepo/myapp:latest-arm64`<br>
 3. å›¢é˜Ÿæˆå‘˜å¦‚ä½•éªŒè¯é•œåƒæ”¯æŒå“ªäº›æ¶æ„ï¼Ÿ<br>
å›¢é˜Ÿæˆå‘˜å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æŸä¸ªé•œåƒæ”¯æŒçš„æ¶æ„ï¼š<br>
```bash<br>
docker manifest inspect myrepo/myapp:latest<br>
```<br>
å¦‚æœè¿™æ˜¯ä¸€ä¸ªå¤šæ¶æ„é•œåƒï¼Œä¼šè¿”å› JSON ç»“æœï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªæ¶æ„çš„æ”¯æŒä¿¡æ¯ï¼š<br>
```json<br>
"manifests": [<br>
  {<br>
    "platform": {<br>
      "architecture": "amd64",<br>
      "os": "linux"<br>
    }<br>
  },<br>
  {<br>
    "platform": {<br>
      "architecture": "arm64",<br>
      "os": "linux"<br>
    }<br>
  },<br>
  {<br>
    "platform": {<br>
      "architecture": "ppc64le",<br>
      "os": "linux"<br>
    }<br>
  }<br>
]<br>
```<br>
è¿™æ„å‘³ç€ï¼š<br>
- `docker pull myrepo/myapp:latest` åœ¨ä¸åŒæ¶æ„çš„æœºå™¨ä¸Šä¼šæ‹‰å–ä¸åŒçš„ç‰ˆæœ¬ï¼Œä½†å¯¹ç”¨æˆ·è€Œè¨€æ˜¯é€æ˜çš„ã€‚<br>
 4. å¤šæ¶æ„é•œåƒçš„å›¢é˜Ÿåä½œæ–¹å¼<br>
- å¼€å‘è€…/è¿ç»´ï¼ˆDevOpsï¼‰æ„å»ºå¤šæ¶æ„é•œåƒï¼š<br>
  - è´Ÿè´£ `Dockerfile` ç»´æŠ¤ã€æ„å»ºå¹¶æ¨é€åˆ°é•œåƒä»“åº“ã€‚<br>
  - é€šè¿‡ `buildx` è¿›è¡Œå¤šæ¶æ„æ„å»ºï¼Œå¹¶åˆ›å»º `manifest`ã€‚<br>
- å›¢é˜Ÿæˆå‘˜ï¼ˆå¼€å‘è€…ã€æµ‹è¯•äººå‘˜ã€è¿ç»´ï¼‰ï¼š<br>
  - åªéœ€è¦ `docker pull` ç»Ÿä¸€çš„é•œåƒåç§°ï¼Œæ— éœ€å…³å¿ƒæ¶æ„å…¼å®¹æ€§ã€‚<br>
 CI/CD è‡ªåŠ¨æ„å»º<br>
å¯ä»¥é…ç½® CI/CDï¼ˆå¦‚ GitHub Actionsã€GitLab CIã€Jenkinsï¼‰ æ¥è‡ªåŠ¨æ„å»ºå’Œå‘å¸ƒå¤šæ¶æ„é•œåƒï¼š<br>
- ä»£ç æäº¤åè‡ªåŠ¨è§¦å‘ `docker buildx build --platform linux/amd64,linux/arm64,linux/ppc64le`ã€‚<br>
- è®© DevOps åªéœ€è¦ç®¡ç† `Dockerfile`ï¼Œè€Œä¸ç”¨æ‰‹åŠ¨æ„å»ºå¤šæ¶æ„é•œåƒã€‚<br>
 5. ç»“è®º<br>
âœ… å¤šæ¶æ„é•œåƒæ˜¯å¼€å‘è€…æˆ– DevOps å…ˆæ„å»ºå¥½çš„ï¼Œå›¢é˜Ÿå…¶ä»–æˆå‘˜æ‰èƒ½ç›´æ¥ä½¿ç”¨ã€‚  <br>
âœ… å›¢é˜Ÿæˆå‘˜ä½¿ç”¨æ—¶ï¼Œ`docker pull` ç»Ÿä¸€çš„é•œåƒåç§°ï¼ŒDocker ä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æ¶æ„ç‰ˆæœ¬ã€‚  <br>
âœ… å¯ä»¥ç”¨ `docker manifest inspect` æŸ¥çœ‹æŸä¸ªé•œåƒæ˜¯å¦æ”¯æŒå¤šæ¶æ„ã€‚  <br>
âœ… CI/CD å¯ä»¥è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒå¤šæ¶æ„é•œåƒï¼Œè®©å›¢é˜Ÿåä½œæ›´åŠ é«˜æ•ˆã€‚ ğŸš€<br>
